function idid(e){return document.getElementById(e)}function IsArray(e){return e&&"object"==typeof e&&"number"==typeof e.length&&!e.propertyIsEnumerable("length")}function Process(){SetTab(),window.IsCollapsible=idid("CollapsibleView").checked;var json=idid("RawJson").value,html="";try{if(""==json)return void(json='""');var obj=eval("["+json+"]");html=ProcessObject(obj[0],0,!1,!1,!1),idid("Canvas").innerHTML="<PRE class='CodeContainer'>"+html+"</PRE>",tips_clear()}catch(e){tips_error("JSON数据格式不正确:\n"+e.message),idid("Canvas").innerHTML=""}}function ProcessObject(e,n,i,o,t){var a="",s=i?"<span class='Comma'>,</span> ":"",l=typeof e;if(IsArray(e))if(0==e.length)a+=GetRow(n,"<span class='ArrayBrace'>[ ]</span>"+s,t);else{a+=GetRow(n,"<span class='ArrayBrace'>[</span>"+(window.IsCollapsible?'<span><img src="'+window.ImgExpanded+'" onClick="ExpImgClicked(this)" /></span><span class=\'collapsible\'>':""),t);for(var r=0;r<e.length;r++)a+=ProcessObject(e[r],n+1,r<e.length-1,!0,!1);a+=GetRow(n,(window.IsCollapsible?"</span>":"")+"<span class='ArrayBrace'>]</span>"+s)}else if("object"==l)if(null==e)a+=FormatLiteral("null","",s,n,o,"Null");else if(e.constructor==window._dateObj.constructor)a+=FormatLiteral("new Date("+e.getTime()+") /*"+e.toLocaleString()+"*/","",s,n,o,"Date");else if(e.constructor==window._regexpObj.constructor)a+=FormatLiteral("new RegExp("+e+")","",s,n,o,"RegExp");else{var d=0;for(var c in e)d++;if(0==d)a+=GetRow(n,"<span class='ObjectBrace'>{ }</span>"+s,t);else{a+=GetRow(n,"<span class='ObjectBrace'>{</span>"+(window.IsCollapsible?'<span><img src="'+window.ImgExpanded+'" onClick="ExpImgClicked(this)" /></span><span class=\'collapsible\'>':""),t);var p=0;for(var c in e){var u=window.QuoteKeys?'"':"";a+=GetRow(n+1,"<span class='PropertyName'>"+u+c+u+"</span>: "+ProcessObject(e[c],n+1,++p<d,!1,!0))}a+=GetRow(n,(window.IsCollapsible?"</span>":"")+"<span class='ObjectBrace'>}</span>"+s)}}else"number"==l?a+=FormatLiteral(e,"",s,n,o,"Number"):"boolean"==l?a+=FormatLiteral(e,"",s,n,o,"Boolean"):"function"==l?e.constructor==window._regexpObj.constructor?a+=FormatLiteral("new RegExp("+e+")","",s,n,o,"RegExp"):a+=FormatLiteral(e=FormatFunction(n,e),"",s,n,o,"Function"):a+="undefined"==l?FormatLiteral("undefined","",s,n,o,"Null"):FormatLiteral(e.toString().split("\\").join("\\\\").split('"').join('\\"'),'"',s,n,o,"String");return a}function FormatLiteral(e,n,i,o,t,a){"string"==typeof e&&(e=e.split("<").join("&lt;").split(">").join("&gt;"));var s="<span class='"+a+"'>"+n+e+n+i+"</span>";return t&&(s=GetRow(o,s)),s}function FormatFunction(e,n){for(var i="",o=0;o<e;o++)i+=window.TAB;var t=n.toString().split("\n"),a="";for(o=0;o<t.length;o++)a+=(0==o?"":i)+t[o]+"\n";return a}function GetRow(e,n,i){for(var o="",t=0;t<e&&!i;t++)o+=window.TAB;return null!=n&&0<n.length&&"\n"!=n.charAt(n.length-1)&&(n+="\n"),o+n}function CollapsibleViewClicked(){idid("CollapsibleViewDetail").style.visibility=idid("CollapsibleView").checked?"visible":"hidden",Process()}function QuoteKeysClicked(){window.QuoteKeys=idid("QuoteKeys").checked,Process()}function CollapseAllClicked(){EnsureIsPopulated(),TraverseChildren(idid("Canvas"),function(e){"collapsible"==e.className&&MakeContentVisible(e,!1)},0)}function ExpandAllClicked(){EnsureIsPopulated(),TraverseChildren(idid("Canvas"),function(e){"collapsible"==e.className&&MakeContentVisible(e,!0)},0)}function MakeContentVisible(e,n){var i=e.previousSibling.firstChild;i.tagName&&"img"==i.tagName.toLowerCase()&&(e.style.display=n?"inline":"none",e.previousSibling.firstChild.src=n?window.ImgExpanded:window.ImgCollapsed)}function TraverseChildren(e,n,i){for(var o=0;o<e.childNodes.length;o++)TraverseChildren(e.childNodes[o],n,i+1);n(e,i)}function ExpImgClicked(e){var n=e.parentNode.nextSibling;if(n){var i="none",o=window.ImgCollapsed;"none"==n.style.display&&(i="inline",o=window.ImgExpanded),n.style.display=i,e.src=o}}function CollapseLevel(i){EnsureIsPopulated(),TraverseChildren(idid("Canvas"),function(e,n){"collapsible"==e.className&&MakeContentVisible(e,!(i<=n))},0)}function TabSizeChanged(){Process()}function SetTab(){var e=idid("TabSize");window.TAB=MultiplyString(parseInt(e.options[e.selectedIndex].value),window.SINGLE_TAB)}function EnsureIsPopulated(){!idid("Canvas").innerHTML&&idid("RawJson").value&&Process()}function MultiplyString(e,n){for(var i=[],o=0;o<e;o++)i.push(n);return i.join("")}function SelectAllClicked(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}var e=document.body&&document.body.createTextRange?document.body.createTextRange():document.createRange();e.selectNode?e.selectNode(idid("Canvas")):e.moveToElementText&&e.moveToElementText(idid("Canvas")),e.select?e.select(idid("Canvas")):window.getSelection().addRange(e)}function LinkToJson(){var e=idid("RawJson").value;e=escape(e.split("/n").join(" ").split("/r").join(" ")),idid("InvisibleLinkUrl").value=e,idid("InvisibleLink").submit()}window.SINGLE_TAB="  ",window.ImgCollapsed=WW_PUBLIC+"/js/tool/json_format/Collapsed.gif",window.ImgExpanded=WW_PUBLIC+"/js/tool/json_format/Expanded.gif",window.QuoteKeys=!0,window._dateObj=new Date,window._regexpObj=new RegExp;